---
import { getCollection } from 'astro:content'
import PostIntro from '../components/PostIntro.astro'
import BaseLayout from '../layouts/BaseLayout.astro'
import { slugifyPost, sortPosts } from '../utils'

export interface Props {
	data: {
		title: string
		date: string
		draft: boolean
		tags: string[]
	}
	id: string
}

const { data } = Astro.props

const title = data?.title

// Generate a new path for every collection entry
export async function getStaticPaths() {
	const posts = await getCollection('posts')
	const postsSorted = sortPosts(posts)

	return postsSorted.map((post) => ({
		params: { slug: slugifyPost(post) },
		props: { post },
	}))
}

const { post } = Astro.props
const { Content } = await post.render()
---

<BaseLayout
	title={title + ' — Duncan Ritchie’s blog'}
	description={`Blogpost by Duncan Ritchie entitled “${title}”`}
	showBlogHomeLinkInFooter={true}
>
	<PostIntro data={post.data} />

	<main>
		<Content />
	</main>
</BaseLayout>
